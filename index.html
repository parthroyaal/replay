<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSV Data Table (Limited Rows)</title>
</head>
<body>

  <h1>CSV Data Table</h1>

  <div id="fetchSupportMessage"></div>
  <div id="fileLoadLog" style="color: black;"></div> 
  <input type="file" id="csvFile" accept=".csv"> 

  <div id="tableContainer"></div>

  <script>
    const csvFile = document.getElementById('csvFile');
    const tableContainer = document.getElementById('tableContainer');
    const fetchSupportMessage = document.getElementById('fetchSupportMessage');
    const fileLoadLog = document.getElementById('fileLoadLog'); 
    const maxRowsToDisplay = 10;

    // Check if fetch is supported
    if (window.fetch) {
      fetchSupportMessage.textContent = "Fetch API is supported! ðŸŽ‰";
    } else {
      fetchSupportMessage.textContent = "Fetch API is not supported. ðŸ˜¥";
      csvFile.disabled = true; 
    }

    csvFile.addEventListener('change', (event) => {
      const file = event.target.files[0];
      fileLoadLog.textContent = ''; 

      const fileReader = new FileReader();

      // 1. Handle File Read Errors
      fileReader.onerror = (error) => {
        console.error('Error reading file:', error);
        fileLoadLog.textContent += `Error reading file: ${error.message}\n`; 
      };

      fileReader.onload = (e) => {
        console.log('Data URL:', e.target.result); 

        // 2. Handle Fetch Errors
        fetch(e.target.result)
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.text();
          })
          .then(csvData => {
            const rows = csvData.split('\n');
            const headers = rows[0].split(',');

            const table = document.createElement('table');
            const headerRow = document.createElement('tr');

            headers.forEach(header => {
              const th = document.createElement('th');
              th.textContent = header;
              headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            for (let i = 1; i <= maxRowsToDisplay && i < rows.length; i++) {
              const row = rows[i].split(',');
              const tableRow = document.createElement('tr');

              row.forEach(cell => {
                const td = document.createElement('td');
                td.textContent = cell;
                tableRow.appendChild(td);
              });
              table.appendChild(tableRow);
            }

            tableContainer.innerHTML = '';
            tableContainer.appendChild(table);
            fileLoadLog.textContent += 'CSV data loaded successfully.\n'; // Success message
          })
          .catch(error => {
            console.error('Error reading CSV file:', error);
            fileLoadError.textContent += `Error loading CSV data: ${error.message}\n`; 
          });
      };
      // Correctly read as a data URL from the Blob object
      fileReader.readAsDataURL(file); 

      csvFile.click(); 
    });
  </script>
</body>
</html>